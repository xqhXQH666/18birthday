<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18岁成人礼 - 生日快乐</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #ff9ecb, #c86bf3, #ffcc70);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 2.2rem;
            margin-bottom: 25px;
            text-align: center;
            color: #ffde59;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* 相冊样式 */
        .album-container {
            display: flex;
            align-items: center;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 10; /* 确保相册在漂浮元素之上 */
        }

        .album-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .album-image-container {
            width: 100%;
            height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.1);
            z-index: 10; /* 确保图片在漂浮元素之上 */
        }

        .album-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: opacity 0.3s ease;
            opacity: 0.5;
        }

        .album-counter {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 20; /* 确保计数器在图片之上 */
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 20; /* 确保按钮在图片之上 */
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .album-thumbnails {
            display: flex;
            overflow-x: auto;
            padding: 15px 0;
            gap: 10px;
            margin-top: 20px;
            scrollbar-width: thin;
        }

        .album-thumbnails::-webkit-scrollbar {
            height: 8px;
        }

        .album-thumbnails::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .album-thumbnails::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .thumbnail.active {
            opacity: 1;
            border-color: #ffde59;
            transform: scale(1.05);
        }

        .thumbnail:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffde59;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 朋友眼中的我样式 */
        .friends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .friend-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .friend-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }

        .friend-text {
            color: #fff;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .friend-name {
            text-align: right;
            color: #ffde59;
            font-weight: bold;
            font-size: 18px;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        button {
            background: #ff6bb5;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            background: #ff4fa3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }

        /* 漂浮元素容器 - 修复关键样式 */
        #floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* 确保在所有内容下方 */
            pointer-events: none; /* 使漂浮元素不阻挡点击事件 */
        }

        .heart, .balloon {
            position: absolute;
            z-index: 0; /* 确保在所有内容下方 */
            opacity: 0.7;
            animation: float 5s infinite ease-in-out;
        }

        .heart:before, .heart:after {
            content: '';
            width: 20px;
            height: 20px;
            background: #ff6bb5;
            border-radius: 50%;
            position: absolute;
        }

        .heart:before {
            top: -10px;
            left: 0;
        }

        .heart:after {
            top: 0;
            left: -10px;
        }

        .balloon {
            width: 40px;
            height: 50px;
            border-radius: 50%;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            font-size: 18px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .subtitle {
                font-size: 1.2rem;
            }

            .friends-grid {
                grid-template-columns: 1fr;
            }

            .album-image-container {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Happy 18th Birthday!</h1>
            <div class="subtitle">欢迎来到夏谦惠的18岁成人礼</div>
        </header>

        <!-- 相冊部分 -->
        <section class="section">
            <h2><i class="fas fa-images"></i> 回忆相册</h2>
            <p style="text-align: center; margin-bottom: 20px;">点击左右箭头或使用键盘方向键浏览照片</p>

            <div class="album-container">
                <button id="prev-btn" class="nav-btn"><i class="fas fa-chevron-left"></i></button>

                <div class="album-view">
                    <div class="album-image-container">
                        <img id="album-image" src="" alt="相册照片">
                    </div>
                    <div class="album-counter" id="album-counter"></div>
                </div>

                <button id="next-btn" class="nav-btn"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="album-thumbnails" id="album-thumbnails">
                <!-- 缩略图将通过JS动态添加 -->
            </div>
        </section>

        <!-- 朋友眼中的我部分 -->
        <section class="section">
            <h2><i class="fas fa-heart"></i> 生日寄语</h2>
            <p style="text-align: center; margin-bottom: 20px;">来自朋友和家人的祝福</p>

            <!-- 消息容器 -->
            <div id="message-container"></div>

            <div class="friends-grid">
                <!-- 朋友祝福卡片将通过JS动态添加 -->
            </div>
        </section>

        <footer>
            <p>Made with ❤️ for your 18th birthday</p>
        </footer>
    </div>

    <!-- 漂浮元素容器 - 已修复 -->
    <div id="floating-elements"></div>

    <script>
        // =============== 重要配置 ===============
        // 1. 替换为你的GitHub用户名和仓库名
        const GITHUB_REPO = "xqhXQH666/18birthday"; // 格式: "用户名/仓库名"

        // 2. 专用账号的Token（已嵌入，访问者无需输入）
        const GITHUB_TOKEN = "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";
        // =============== 重要配置 ===============

        // =============== 手动图片链接配置 ===============
        // 替换下面的10个URL为您自己的图片链接
        // 确保是直接图片链接（以.jpg, .png等结尾）
        const PHOTO_URLS = [
            "http://t1nt6jv29.hn-bkt.clouddn.com/9.jpg", // 替换为您的第一个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/2.jpg", // 替换为您的第二个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/7.jpg", // 替换为您的第三个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/6.jpg", // 替换为您的第四个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/10.jpg", // 替换为您的第五个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/8.jpg", // 替换为您的第六个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/1.jpg", // 替换为您的第七个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/5.jpg", // 替换为您的第八个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/4.jpg", // 替换为您的第九个图片链接
            "http://t1nt6jv29.hn-bkt.clouddn.com/3.jpg" // 替换为您的第十个图片链接
        ];
        // =============== 手动图片链接配置 ===============

        // 本地测试数据（当GitHub不可用时使用）
        const localTestData = [
            {
                text: "记得我们第一次见面的时候，你就笑得这么灿烂，祝你永远保持这份快乐！",
                name: "小雯"
            },
            {
                text: "18岁是人生新的起点，愿你的未来如同星空般璀璨耀眼！",
                name: "晓芳"
            },
            {
                text: "和你一起度过的中学时光是我最珍贵的回忆，成人快乐！",
                name: "婷婷"
            }
        ];

        // =============== 相冊功能 ===============
        let albumPhotos = [];
        let currentPhotoIndex = 0;
        let albumLoading = false;

        // 初始化相册
        function initAlbum() {
            // 创建相册数据
            albumPhotos = PHOTO_URLS.map(url => ({
                src: url
            }));

            // 显示第一张照片
            displayPhoto(0);


            // 设置事件监听器
            setupAlbumEvents();

            // 支持键盘导航
            document.addEventListener('keydown', handleKeyboardNavigation);
        }

        // 显示指定索引的照片
        function displayPhoto(index) {
            if (index < 0 || index >= albumPhotos.length) return;

            currentPhotoIndex = index;

            const photo = albumPhotos[index];
            const albumImage = document.getElementById('album-image');
            const albumCounter = document.getElementById('album-counter');

            // 设置图片
            albumImage.src = photo.src;
            albumImage.alt = `照片 ${index + 1}`;
            albumImage.style.opacity = "0.5"; // 开始时半透明

            // 图片加载完成后淡入
            albumImage.onload = function() {
                albumImage.style.opacity = "1";
            };

            // 设置计数器
            albumCounter.textContent = `${index + 1} / ${albumPhotos.length}`;

            // 更新缩略图活动状态
            updateThumbnailActiveState();
        }

        // 创建缩略图
        function createThumbnails() {
            const thumbnailsContainer = document.getElementById('album-thumbnails');
            thumbnailsContainer.innerHTML = '';

            albumPhotos.forEach((photo, index) => {
                const thumbnail = document.createElement('img');
                thumbnail.className = 'thumbnail';
                thumbnail.src = photo.src;
                thumbnail.alt = `缩略图 ${index + 1}`;
                thumbnail.dataset.index = index;

                // 点击缩略图跳转到对应照片
                thumbnail.addEventListener('click', () => {
                    displayPhoto(index);
                });

                thumbnailsContainer.appendChild(thumbnail);
            });

            // 设置第一张为活动状态
            updateThumbnailActiveState();
        }

        // 更新缩略图活动状态
        function updateThumbnailActiveState() {
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach((thumb, index) => {
                if (index === currentPhotoIndex) {
                    thumb.classList.add('active');
                } else {
                    thumb.classList.remove('active');
                }
            });
        }

        // 设置相册事件
        function setupAlbumEvents() {
            document.getElementById('prev-btn').addEventListener('click', () => {
                const newIndex = (currentPhotoIndex - 1 + albumPhotos.length) % albumPhotos.length;
                displayPhoto(newIndex);
            });

            document.getElementById('next-btn').addEventListener('click', () => {
                const newIndex = (currentPhotoIndex + 1) % albumPhotos.length;
                displayPhoto(newIndex);
            });
        }

        // 键盘导航
        function handleKeyboardNavigation(e) {
            if (e.key === 'ArrowLeft') {
                const newIndex = (currentPhotoIndex - 1 + albumPhotos.length) % albumPhotos.length;
                displayPhoto(newIndex);
            } else if (e.key === 'ArrowRight') {
                const newIndex = (currentPhotoIndex + 1) % albumPhotos.length;
                displayPhoto(newIndex);
            }
        }

        // 从GitHub获取祝福
        async function loadWishesFromGithub() {
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/issues?labels=wish`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`GitHub API错误: ${response.status}`);
                }

                const issues = await response.json();
                return issues.map(issue => {
                    // 从issue.body解析文字
                    const textMatch = issue.body.match(/\*\*祝福语:\*\* (.*)/);

                    return {
                        get: function(key) {
                            if (key === 'text') return textMatch ? textMatch[1] : issue.body;
                            if (key === 'name') return issue.title.replace('祝福: ', '');
                            return null;
                        },
                        text: textMatch ? textMatch[1] : issue.body,
                        name: issue.title.replace('祝福: ', '')
                    };
                });
            } catch (error) {
                console.error("加载GitHub祝福失败:", error);
                throw error;
            }
        }

        // 保存祝福到GitHub
        async function saveWishToGithub(text, name) {
            const issueData = {
                title: `祝福: ${name}`,
                body: `**祝福语:** ${text}`,
                labels: ["wish"]
            };

            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/issues`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(issueData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`GitHub API错误: ${response.status} - ${errorData.message}`);
                }

                return true;
            } catch (error) {
                console.error("保存到GitHub失败:", error);
                throw error;
            }
        }

        // 加载祝福
        async function loadWishes() {
            const container = document.querySelector('.friends-grid');

            // 完全清空容器
            container.innerHTML = '';

            try {
                // 从GitHub获取数据
                const wishes = await loadWishesFromGithub();

                // 显示所有祝福
                wishes.forEach(wish => {
                    const card = document.createElement('div');
                    card.className = 'friend-card';
                    card.innerHTML = `
                        <p class="friend-text">"${wish.get('text')}"</p>
                        <div class="friend-name">- ${wish.get('name')}</div>
                    `;
                    container.appendChild(card);
                });

                // 重新添加表单
                addUploadForm();
            } catch (error) {
                console.error("加载祝福失败:", error);

                // 显示错误提示
                const errorCard = document.createElement('div');
                errorCard.className = 'friend-card';
                errorCard.style.backgroundColor = 'rgba(255, 0, 0, 0.2)';
                errorCard.innerHTML = `
                    <p class="friend-text" style="color: #ff4444;">加载祝福失败: ${error.message || '请稍后再试'}</p>
                `;
                container.appendChild(errorCard);

                // 仍然显示表单
                addUploadForm();
            }
        }

        // 添加上传表单
        function addUploadForm() {
            const container = document.querySelector('.friends-grid');

            // 先移除已存在的表单（避免重复）
            const existingForm = container.querySelector('#upload-form');
            if (existingForm) container.removeChild(existingForm);

            const formCard = document.createElement('div');
            formCard.id = 'upload-form'; // 设置ID以便后续移除
            formCard.className = 'friend-card';
            formCard.style.textAlign = 'center';
            formCard.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
            formCard.innerHTML = `
                <h3 style="color: #ffde59; margin-bottom: 15px;">留下你的祝福吧！</h3>
                <div style="margin-bottom: 15px;">
                    <label for="friend-text" style="display:block; margin-bottom:5px;">祝福语</label>
                    <textarea id="friend-text" rows="3" style="width:100%; padding:8px; border-radius:8px; border:none;" placeholder="写下你想说的话..." required></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="friend-name" style="display:block; margin-bottom:5px;">你的名字</label>
                    <input type="text" id="friend-name" style="width:100%; padding:8px; border-radius:8px; border:none;" placeholder="例如：小明" required>
                </div>
                <button id="submit-message" style="background:#ffde59; color:#333;">提交祝福</button>
            `;

            container.appendChild(formCard);

            // 提交事件
            const submitButton = document.getElementById('submit-message');
            if (submitButton) {
                submitButton.addEventListener('click', async function () {
                    const text = document.getElementById('friend-text') ? document.getElementById('friend-text').value.trim() : '';
                    const name = document.getElementById('friend-name') ? document.getElementById('friend-name').value.trim() : '';

                    if (!text || !name) {
                        alert("请完整填写所有信息！");
                        return;
                    }

                    try {
                        // 保存到GitHub
                        await saveWishToGithub(text, name);

                        // 清空表单
                        if (document.getElementById('friend-text')) document.getElementById('friend-text').value = '';
                        if (document.getElementById('friend-name')) document.getElementById('friend-name').value = '';

                        alert("祝福提交成功！其他人刷新页面后即可看到");

                        // 重新加载祝福
                        loadWishes();
                    } catch (error) {
                        console.error("提交失败:", error);
                        alert(`提交失败: ${error.message}\n\n请检查网络连接或联系网站管理员`);
                    }
                });
            }
        }

        // 生成随机漂浮元素
        function createFloatingElements() {
            const container = document.getElementById('floating-elements');
            const types = ['heart', 'balloon'];
            const colors = ['#ff6bb5', '#ff8e50', '#6b66ff', '#ffde59', '#58ff6b'];

            for (let i = 0; i < 20; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const element = document.createElement('div');
                element.className = type;

                element.style.left = Math.random() * 100 + 'vw';
                element.style.top = Math.random() * 100 + 'vh';
                element.style.opacity = Math.random() * 0.5 + 0.2;
                element.style.width = (Math.random() * 30 + 20) + 'px';
                element.style.height = type === 'balloon' ? (parseInt(element.style.width) * 1.25) + 'px' : element.style.width;
                element.style.background = colors[Math.floor(Math.random() * colors.length)];
                element.style.animationDelay = Math.random() * 5 + 's';
                element.style.animationDuration = (Math.random() * 10 + 5) + 's';

                container.appendChild(element);
            }
        }

        // 页面加载完成后初始化
        window.onload = function() {
            // 添加手动刷新按钮
            const sectionHeader = document.querySelector('.section h2');
            if (sectionHeader) {
                sectionHeader.insertAdjacentHTML('afterend',
                    '<div style="text-align: center; margin: 15px 0;">' +
                        '<button id="refresh-btn" style="background: #6b66ff; width: auto;">刷新祝福</button>' +
                    '</div>'
                );

                document.getElementById('refresh-btn').addEventListener('click', function() {
                    this.textContent = "刷新中...";
                    loadWishes();
                    setTimeout(() => this.textContent = "刷新祝福", 1500);
                });
            }

            createFloatingElements();
            initAlbum();  // 初始化相册
            loadWishes(); // 加载祝福
        };
    </script>
</body>
</html>

